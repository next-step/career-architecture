## ğŸš€ë¯¸ì…˜
- ì´ë¦„ : ë°•ê²½ë¯¼

```text
<ê°œì„ ë°©í–¥>
1. (ì„±ëŠ¥ì´ìŠˆ) MQ send ë° consume ë°©ì‹ì„ ê°œì„ í•œë‹¤ => db connection ê°ì†Œ
    - MQ consume ì‹œ loop ëŒë©´ì„œ DB connection ì´ ê³„ì† ë°œìƒí•˜ëŠ” ë¶€ë¶„ì„ ë³€ê²½í•œë‹¤. 
    - MQë¡œëŠ” ìš°ì„  1ê°œì˜ ë©”ì‹œì§€ë§Œ send í•œë‹¤
      => ë©”ì‹œì§€ì—ëŠ” ì–´ëŠ ëª…ë¶€ì—ì„œ ìš”ì²­í–ˆëŠ”ì§€ idê°’ ì •ë„ë§Œ í¬í•¨í•œë‹¤.
    - MQì—ì„œ consumeí•  ë•Œ í•´ë‹¹ idê°’ìœ¼ë¡œ dbì—ì„œ ì£¼ì†Œê²€í†  ëŒ€ìƒì„ ì¡°íšŒ & ì²˜ë¦¬í•œë‹¤.
    - ì²˜ë¦¬ê²°ê³¼ì˜ ê²½ìš° ì„±ê³µëª©ë¡ì— ëŒ€í•´ì„œë§Œ ê²°ê³¼ë¥¼ insert/update bulk ì €ì¥í•œë‹¤.
       => ëª…ë¶€ë“±ë¡ì‹œ ì†Œì¬ì§€ insertí•  ë•Œ ì£¼ì†Œê²€í† ì—¬ë¶€ì— ëŒ€í•œ ì´ˆê¸°ë°ì´í„°ê°€ ì €ì¥ë˜ë¯€ë¡œ,
          ì‹¤íŒ¨ëª©ë¡ì˜ ê²½ìš° ì¶”ê°€ì ì¸ insert/update ê³¼ì •ì´ í•„ìš”ì—†ìœ¼ë¯€ë¡œ ì´ ë¶€ë¶„ì€ ì œê±°í•œë‹¤. 
2. (ì™¸ë¶€ì—°ë™) ì‹¤íŒ¨ì‹œ ì¬ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¶”ê°€í•œë‹¤ => ìë™í™”ë¥¼ í†µí•œ ìˆ˜ì‘ì—… ì¶•ì†Œ
    - ì½”ë“œë ˆë²¨ì—ì„œ ìµœëŒ€ 3íšŒ ì¬ì‹œë„í•¨ìœ¼ë¡œì¨ ì¼ì‹œì ì¸ ì‹¤íŒ¨ê±´ìˆ˜ë¥¼ ê°ì†Œì‹œí‚¨ë‹¤. 
    - ì‹¤ì œ ë°”ë¡œ 1ë²ˆë§Œ ì¬ì‹œë„ë§Œí•´ë„ ì„±ê³µí•˜ëŠ” ê²½ìš°ê°€ ë§ìœ¼ë¯€ë¡œ ì„±ê³µìœ¨ì„ ë†’ì¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.
    - í•´ë‹¹ ê³¼ì •ì—ì„œ 4íšŒ ì´ìƒ ì‹¤íŒ¨ì‹œ DLQì— ìŒ“ê³  ì´ë¶€ë¶„ì€ ê´€ë¦¬ìê°€ ì§ì ‘ í™•ì¸í•˜ì—¬ ì²˜ë¦¬í•œë‹¤.(TBD)
3. (ê¸°íƒ€) third party ì— ì¸í„°ë²Œë¡œ ìš”ì²­í•˜ë„ë¡ ê°œì„ í•´ë³¸ë‹¤ => third party ë¡œì˜ í•œêº¼ë²ˆì˜ ìš”ì²­ ë¶€í•˜ë¥¼ ì¤„ì¸ë‹¤.
    - third party ì¸¡ì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ë˜ì–´ ìˆì§€ ì•ŠëŠ” ê²ƒ ê°™ë‹¤. í•œêº¼ë²ˆì— ë³´ë‚´ë©´ ëŠë ¤ì§€ê±°ë‚˜ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.
    - ë‹¨ê±´ìœ¼ë¡œ ì£¼ì†Œê²€ìƒ‰ ìš”ì²­ì‹œ sleep ì²˜ë¦¬ë¥¼ ì¶”ê°€í•œë‹¤.
    
```

### TO-BE ëª…ë¶€ë“±ë¡ í”„ë¡œì„¸ìŠ¤(ìƒì„¸)

```mermaid
flowchart TD
%% Colors %%
classDef red fill:#FF3399,stroke:#000,stroke-width:2px,color:#fff
classDef green fill:#007700,stroke:#000,stroke-width:2px,color:#fff
classDef sky fill:#0000CD,stroke:#000,stroke-width:2px,color:#fff

    Address(ì†Œì¬ì§€ ëª©ë¡)

    ëª…ë¶€ë“±ë¡-->|ëª…ë¶€/ì†Œì¬ì§€ insert|register[(database)]-->MQ
    subgraph ì†Œì¬ì§€ ì£¼ì†Œê²€í† 
        direction LR
            MQ-->|ê²€í† ëŒ€ìƒ ì¡°íšŒ|locAddress[(database)]-->Address-->|"ì£¼ì†Œê²€ìƒ‰ ìš”ì²­(interval)"|thirdParty
            subgraph "third party ì£¼ì†Œê²€ìƒ‰(loop)"
                thirdParty-->|ì£¼ì†Œê²€ìƒ‰ ê²°ê³¼ë°˜í™˜|Response{ê²€ìƒ‰ ì„±ê³µì—¬ë¶€}
                Response-->|no|ì¬ì²˜ë¦¬
            end
        ì¬ì²˜ë¦¬-->retry{ì¬ì‹œë„ íšŸìˆ˜}
        retry-->|3íšŒ ì´í•˜|thirdParty
        retry-->|3íšŒ ì´ˆê³¼|DLQ-.->ê´€ë¦¬ìí™•ì¸
            Response-->|yes|ì„±ê³µëª©ë¡
            ì„±ê³µëª©ë¡-->|"ê²°ê³¼ ì €ì¥(bulk)"|locDetailAddress[(database)]
    end
    locDetailAddress-->ëª…ë¶€ë“±ë¡ì™„ë£Œ-->ì£¼ì†Œê²€í† ê²°ê³¼{ì£¼ì†Œê²€í†  ë¯¸ì™„ë£Œê±´ ì¡´ì¬ì—¬ë¶€}
    ì£¼ì†Œê²€í† ê²°ê³¼-->|no|ëª…ë¶€ì „ë‹¬
    ì£¼ì†Œê²€í† ê²°ê³¼-->|yes|ê°œë³„ì‘ì—…
    
    thirdParty(third party):::red
    MQ(MQ):::green
    DLQ(DLQ):::green
``` 